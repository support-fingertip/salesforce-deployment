name: Deploy to Salesforce

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Install Salesforce CLI
        run: |
          npm install --global @salesforce/cli
          sf --version
      
      - name: Authenticate to Salesforce
        run: |
          echo "${{ secrets.SALESFORCE_AUTH_URL }}" > authfile.txt
          sf org login sfdx-url --sfdx-url-file authfile.txt --alias deployment-org --set-default
      
      - name: Deploy to Salesforce
        run: |
          sf project deploy start --source-dir force-app --target-org deployment-org --wait 10
      
      - name: Run Apex Tests
        run: |
          sf apex run test --target-org deployment-org --wait 10 --result-format human --code-coverage
```

### **5. Rename the file (optional but cleaner):**

At the top, change the filename from `main.yml` to:
```
deploy.yml
```

### **6. Click "Commit changes..."** (green button, top right)

### **7. In the popup:**
- Commit message: `Add deployment workflow`
- Click **"Commit changes"** (green button)

---

## **What Just Happened:**

You created an automated workflow that will:
1. âœ… Run every time you push code to the `main` branch
2. âœ… Install Salesforce CLI
3. âœ… Authenticate using your secret
4. âœ… Deploy your code to Salesforce
5. âœ… Run all Apex tests

---

## **STEP 8: Watch Your First Deployment! ðŸš€**

### **The workflow just triggered automatically!**

1. **Click the "Actions" tab** (if you're not there already)

2. **You'll see:** "Add deployment workflow" workflow running
   - ðŸŸ¡ Yellow circle = Running
   - ðŸŸ¢ Green checkmark = Success
   - ðŸ”´ Red X = Failed

3. **Click on the workflow name** to see live logs

4. **Watch it deploy!** You'll see:
   - Installing Salesforce CLI
   - Authenticating
   - Deploying components
   - Running tests

---

## **Expected Result:**

After 2-5 minutes, you should see:
```
âœ… Deploy to Salesforce
   Deployed Source
   â”œâ”€â”€ Classes: XX
   â”œâ”€â”€ Triggers: XX
   â””â”€â”€ ...
